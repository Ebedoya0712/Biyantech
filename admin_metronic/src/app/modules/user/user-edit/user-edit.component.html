<!--begin::Modal content-->
<div class="modal-content">
    <!--begin::Modal header-->
    <div class="modal-header">
        <h2 class="fw-bolder">Editar Usuario: Nº: {{ user?.id }} | {{ user?.name }}</h2>
        <button type="button" class="btn btn-icon btn-sm btn-active-icon-primary" (click)="modal.dismiss()">
            <span class="svg-icon svg-icon-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                    <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                </svg>
            </span>
        </button>
    </div>
    <!--end::Modal header-->
    
    <!--begin::Modal body-->
    <div class="modal-body scroll-y mx-5 mx-xl-15 ">
        
        <!-- Stepper Navigation -->
        <div class="stepper-nav mb-10">
            <div class="stepper-item" [class.current]="currentStep === 1">
                <div class="stepper-line"></div>
                <div class="stepper-icon">1</div>
                <div class="stepper-label">
                    <h3 class="stepper-title">Información Básica</h3>
                    <div class="stepper-desc">Datos personales</div>
                </div>
            </div>
            <div class="stepper-item" [class.current]="currentStep === 2">
                <div class="stepper-line"></div>
                <div class="stepper-icon">2</div>
                <div class="stepper-label">
                    <h3 class="stepper-title">Configuración</h3>
                    <div class="stepper-desc">Permisos y seguridad</div>
                </div>
            </div>
        </div>

        <!-- Step 1: Información Básica -->
        <div *ngIf="currentStep === 1" class="step-content">
            <!-- Avatar -->
            <div class="fv-row mb-7">
                <label class="d-block fw-bold fs-6 mb-5 text-center">Avatar</label>
                <div class="image-input-placeholder">
                    <div class="avatar-preview mx-auto">
                        <img [src]="IMAGEN_PREVISUALIZA" class="avatar-img" alt="Avatar">
                    </div>
                    <label class="btn btn-primary btn-sm mt-2">
                        <i class="bi bi-camera me-2"></i>
                        Cambiar Imagen
                        <input type="file" hidden accept=".png, .jpg, .jpeg" (change)="processAvatar($event)">
                    </label>
                </div>
                <div class="form-text text-center">Tipos de archivo permitidos: png, jpg, jpeg.</div>
            </div>

            <!-- Nombres -->
            <div class="fv-row mb-7">
                <label class="required fw-bold fs-6 mb-2">Nombres</label>
                <input type="text" class="form-control form-control-solid" 
                       placeholder="Ingresa los nombres" 
                       [(ngModel)]="name" name="name">
            </div>

            <!-- Apellidos -->
            <div class="fv-row mb-7">
                <label class="required fw-bold fs-6 mb-2">Apellidos</label>
                <input type="text" class="form-control form-control-solid" 
                       placeholder="Ingresa los apellidos" 
                       [(ngModel)]="surname" name="surname">
            </div>

            <!-- Email -->
            <div class="fv-row mb-7">
                <label class="required fw-bold fs-6 mb-2">Email</label>
                <input type="email" class="form-control form-control-solid" 
                       placeholder="ejemplo@correo.com" 
                       [(ngModel)]="email" name="email">
            </div>

            <!-- Estatus -->
            <div class="fv-row mb-7">
                <label class="required fw-bold fs-6 mb-2">Estatus</label>
                <select class="form-control form-control-solid" [(ngModel)]="state" name="state">
                    <option value="1">Activo</option>
                    <option value="2">Inactivo</option>
                </select>
            </div>
        </div>

        <!-- Step 2: Configuración -->
        <div *ngIf="currentStep === 2" class="step-content">
            <!-- Rol -->
            <div class="fv-row mb-7">
                <label class="required fw-bold fs-6 mb-2">Rol del Usuario</label>
                <select class="form-control form-control-solid" [(ngModel)]="role_id" name="role_id">
                    <option value="">-- Selecciona un rol --</option>
                    <option *ngFor="let role of roles" [value]="role.id">
                        {{ role.name }}
                    </option>
                </select>
                <div class="form-text">Define los permisos y acceso del usuario en el sistema</div>
            </div>

            <!-- Contraseña -->
            <div class="fv-row mb-7">
                <label class="fw-bold fs-6 mb-2">Nueva Contraseña</label>
                <input type="password" class="form-control form-control-solid" 
                       placeholder="Dejar en blanco para mantener la actual" 
                       [(ngModel)]="password" name="password">
            </div>

            <!-- Confirmar Contraseña -->
            <div class="fv-row mb-7">
                <label class="fw-bold fs-6 mb-2">Confirmar Contraseña</label>
                <input type="password" class="form-control form-control-solid" 
                       placeholder="Repite la contraseña" 
                       [(ngModel)]="confirmation_password" name="confirmation_password">
            </div>

            <!-- Es Instructor -->
            <div class="mb-7">
                <label class="form-label fw-bold">¿Es instructor?</label>
                <div class="form-check form-check-solid">
                    <input class="form-check-input" type="checkbox" 
                           [checked]="is_instructor" (change)="isInstructor()" id="instructorCheck">
                    <label class="form-check-label" for="instructorCheck">
                        Sí, es instructor
                    </label>
                </div>
                <div class="text-muted fs-7">Habilita las opciones de instructor</div>
            </div>

            <!-- Profesión (condicional) -->
            <div class="mb-7" *ngIf="is_instructor">
                <label class="fw-bold fs-6 mb-2">Profesión</label>
                <input type="text" class="form-control form-control-solid" 
                       placeholder="Ej: Desarrollador Web" 
                       [(ngModel)]="profesion" name="profesion">
            </div>

            <!-- Descripción (condicional) -->
            <div class="mb-7" *ngIf="is_instructor">
                <label class="fw-bold fs-6 mb-2">Descripción</label>
                <textarea class="form-control form-control-solid" 
                          placeholder="Describe la experiencia del instructor..." 
                          [(ngModel)]="description" name="description" rows="4"></textarea>
            </div>
        </div>

        <!-- Actions -->
        <div class="d-flex justify-content-between ">
            <div>
                <button type="button" class="btn btn-light-primary" 
                        (click)="previousStep()" *ngIf="currentStep === 2">
                    <i class="bi bi-arrow-left me-2"></i>
                    Anterior
                </button>
            </div>
            
            <div>
                <button type="button" class="btn btn-primary me-3" 
                        (click)="nextStep()" *ngIf="currentStep === 1">
                    Siguiente
                    <i class="bi bi-arrow-right ms-2"></i>
                </button>
                
                <button type="button" class="btn btn-success me-3" 
                        (click)="store()" *ngIf="currentStep === 2"
                        [disabled]="(isLoading | async)">
                    <span class="indicator-label">Actualizar Usuario</span>
                    <span class="spinner-border spinner-border-sm align-middle ms-2" 
                          *ngIf="(isLoading | async)"></span>
                </button>
                
                <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
                    Cancelar
                </button>
            </div>
        </div>

    </div>
    <!--end::Modal body-->
</div>
<!--end::Modal content-->